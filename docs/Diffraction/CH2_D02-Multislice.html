

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2.17. Multislice Algorithm &#8212; Introduction to Transmisison Electron Microscopy</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Diffraction/CH2_D02-Multislice';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.18. CBED - Multislice Algorithm" href="CH2_D03-Multislice_CBED.html" />
    <link rel="prev" title="2.16. Bethe Theory" href="CH2_D01-Bloch.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Introduction to Transmisison Electron Microscopy - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Introduction to Transmisison Electron Microscopy - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Foreword (ReadME)
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Introduction/CH1_00-Introduction.html">1. Chapter 1: Introduction</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Introduction/CH1_01-Introduction_Python.html">1.1. Introduction to Python as it is used in this lecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Introduction/CH1_02-Prerequisites.html">1.2. Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Introduction/CH1_03-Data_Representation.html">1.3. Matplotlib and Numpy for Micrographs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Introduction/CH1_04-Open_File.html">1.4. Open DM3 Images, Spectra, Spectrum-Images and  Image-Stacks with pyNSID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Introduction/CH1_05-Course_Organization.html">1.5. Course Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Introduction/CH1_06-Overview.html">1.6. Overview Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Introduction/install_conda.html">1.7. Installation on your own computer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Introduction/computer_resources.html">1.8. Setting up computing resources</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="CH2_00-Diffraction.html">2. Chapter 2:  Diffraction</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="CH2_01-Electron.html">2.2. The Electron</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_02-Atomic_Form_Factor.html">2.3. Atomic Form Factor</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_03-Basic_Crystallography.html">2.4. Basic Crystallography</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_04-Structure_Factors.html">2.5. Structure Factors</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_05-Diffraction_Rings.html">2.6. Analyzing Ring Diffraction Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_06-Kinematic_Scattering_Geometry.html">2.7. Kinematic Scattering Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_07-Plotting_Diffraction_Pattern.html">2.8. Plotting Diffraction Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_08-Spot_Diffraction_Pattern.html">2.9. Analyzing Spot Diffraction Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_09-Unit_Cell.html">2.10. Unic Cell Determination and Stereographic Projection</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_10-Kikuchi_Lines.html">2.11. Kikuchi Lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_11-HOLZ_Lines.html">2.12. HOLZ Lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_12-HOLZ_Example.html">2.13. Lattice Determination with HOLZ</a></li>


<li class="toctree-l2"><a class="reference internal" href="CH2_D01-Bloch.html">2.16. Bethe Theory</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">2.17. Multislice Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="CH2_D03-Multislice_CBED.html">2.18. CBED - Multislice Algorithm</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Imaging/CH3_00-Imaging.html">3. Chapter 3: Imaging</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Imaging/CH3_01-Resolution.html">3.2. Resolution Limit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging/CH3_03-CTF.html">3.3. Contrast Transfer Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging/CH3_04-Linear_Image_Approximation.html">3.4. Linear Image Approximation: Weak Phase Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging/CH3_05-Defocus_Thickness.html">3.5. Defocus-Thickness Map with Multislice Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging/CH3_06-Image_Processing.html">3.6. Image Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging/CH3_07-Image_Analysis.html">3.7. Image Analysis</a></li>

<li class="toctree-l2"><a class="reference internal" href="../Imaging/CH3_08-Thermal_Diffuse_Scattering.html">3.9. Thermal-Diffuse Scattering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging/CH3_09-Z_Contrast.html">3.10. Z-Contrast Imaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Imaging/CH3_10-Ronchigram.html">3.11. Ronchigram</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Spectroscopy/CH4_00-Spectroscopy.html">4. Chapter 4: Spectroscopy</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_01-Introduction.html">4.1. Introduction to  Electron Energy-Loss Spectroscopy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_02-Fit_Zero_Loss.html">4.2. Fit of Zero-Loss Peak</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_03-Drude.html">4.3. Analysing Low-Loss Spectra with Drude Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_07-Introduction_Core_Loss.html">4.4. Introduction to Core-Loss Spectroscopy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_08-Chemical_Composition.html">4.5. Chemical Composition in Core-Loss Spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_09-Analyse_Core_Loss.html">4.6. Analysis of Core-Loss Spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_10-ELNES.html">4.7. Energy-Loss Near-Edge Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_12-Introduction_X_Rays.html">4.8. Chapter 4 <span class="xref myst">Spectroscopy</span></a></li>

<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_13-Bremsstrahlung.html">4.10. Chapter 4 <span class="xref myst">Spectroscopy</span></a></li>

<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_14-Characteristic_X_Rays.html">4.12. Chapter 4 <span class="xref myst">Spectroscopy</span></a></li>

<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_15-Detector.html">4.14. Chapter 4 <span class="xref myst">Spectroscopy</span></a></li>



<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_16-Analyze_EDS_Spectrum.html">4.18. Chapter 4 <span class="xref myst">Spectroscopy</span></a></li>


<li class="toctree-l2"><a class="reference internal" href="../Spectroscopy/CH4_17-Quantify_EDS_Spectrum.html">4.21. Chapter 4 <span class="xref myst">Spectroscopy</span></a></li>




</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Homework/homework.html">5. Homework</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Homework/Homework01.html">5.1. Homework 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Homework/Homework02.html">5.2. Homework 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Homework/Homework03.html">5.3. Homework 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Homework/Homework04.html">5.4. Homework 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Homework/Homework05-CBED.html">5.5. HW5:  Analyzing CBED Pattern</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Homework/Homework06-TwoBeam.html">5.6. HW6:  Analyzing CBED Pattern in Two Beam Condition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Homework/Homework07-Dynamic_CBED.html">5.7. HW7:  Simulating CBED Pattern</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/gduscher/MSE672-Introduction-to-TEM/main?urlpath=tree/docs/Diffraction/CH2_D02-Multislice.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/gduscher/MSE672-Introduction-to-TEM" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/gduscher/MSE672-Introduction-to-TEM/issues/new?title=Issue%20on%20page%20%2FDiffraction/CH2_D02-Multislice.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Diffraction/CH2_D02-Multislice.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Multislice Algorithm</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">2.17.1. Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-relevant-python-packages">2.17.2. Load relevant python packages</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-installed-packages">2.17.2.1. Check Installed Packages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-numerical-and-plotting-python-packages">2.17.2.2. Import numerical and plotting python packages</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview-of-multislice-algorithm">2.17.3. Overview of Multislice Algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step1-projected-potential">2.17.4. Step1: Projected Potential</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#projected-potential-from-parametrization-of-atomic-form-factor">2.17.4.1. Projected Potential from Parametrization of Atomic Form Factor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-quarter-of-projected-atom-potential">2.17.4.2. Plot quarter of projected atom potential</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-full-projected-atom-potential">2.17.4.3. Plot full projected atom potential</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#embedd-atoms-in-projected-crystals">2.17.4.4. Embedd atoms in projected crystals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#projected-potential-of-supercell">2.17.4.5. Projected Potential of Supercell</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#all-together-in-a-function">2.17.4.6. All together in a function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-slice-crystal">2.17.5. Step 2: Slice Crystal.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-transmission-function-for-each-slice">2.17.6. Step 3: Transmission Function for Each Slice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-propagator">2.17.7. Step 4: Propagator</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-incident-wave">2.17.8. Step 5: Incident Wave</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-multislice-loop">2.17.9. Step 6: Multislice Loop</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diffraction-pattern">2.17.10. Diffraction Pattern</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">2.17.11. Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#navigation">2.17.12. Navigation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><font size = "5"> <strong>Chapter 2: <a class="reference internal" href="CH2_00-Diffraction.html"><span class="doc std std-doc">Diffraction</span></a></strong> </font></p>
<hr style="height:1px;border-top:4px solid #FF8200" />
<section class="tex2jax_ignore mathjax_ignore" id="multislice-algorithm">
<h1><span class="section-number">2.17. </span>Multislice Algorithm<a class="headerlink" href="#multislice-algorithm" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://raw.githubusercontent.com/gduscher/MSE672-Introduction-to-TEM//main/Diffraction/CH2_D02-Multislice.ipynb">Download</a></p>
<p><a class="reference external" href="https://colab.research.google.com/github/gduscher/MSE672-Introduction-to-TEM/blob/main//Diffraction/CH2_D02-Multislice.ipynb"><img alt="OpenInColab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>part of</p>
<p><font size = "5"> <strong><a class="reference internal" href="../_MSE672_Intro_TEM.html"><span class="doc std std-doc">MSE672:  Introduction to Transmission Electron Microscopy</span></a></strong></font></p>
<p><strong>Spring 2024</strong></p>
<table style="margin-right:auto;margin-left:0px">
  <tr>
    <td>Gerd Duscher </td>
    <td>Khalid Hattar</td>
  </tr>
  <tr>
    <td>Microscopy Facilities</td> 
    <td> Tennessee Ion Beam Materials Laboratory </td>
  </tr>
  <tr>
    <td>Materials Science & Engineering</td>
    <td> Nuclear Engineering</td>
  </tr>
  <tr>
    <td>Institute of Advanced Materials & Manufacturing</td>
    <td> </td>
  </tr>
  <tr>
    <td colspan="2"><center> The University of Tennessee, Knoxville</center> </td>
  </tr>
</table>
<p>Background and methods to analysis and quantification of data acquired with transmission electron microscopes</p>
<section id="introduction">
<h2><span class="section-number">2.17.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>In this notebook, we will make a dynamic simulation of the scattering process.</p>
<p>The core of this algorithm is used in many different libraries.</p>
<p>I follow in my description mostly the book of Kirkland, from where we also use the scattering parameters. The code has been completely rewritten so that the mechnaism of the algorithm can be understood on a basic level.</p>
<p>All commercial and open-source codes use the same base algorithm but are highly tuned for usability, variabilty, features and speed. This was not the goal here.</p>
<p>Here are a few of the more common open-source programs</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/jacobjma/abTEM">abTEM</a></p></li>
<li><p><a class="reference external" href="https://github.com/JJPPeters/clTEM">clTEM</a></p></li>
<li><p><a class="reference external" href="https://github.com/ningustc/MuSTEM">MuSTEM</a></p></li>
<li><p><a class="reference external" href="https://er-c.org/barthel/drprobe/">Dr. Probe</a></p></li>
</ul>
</section>
<section id="load-relevant-python-packages">
<h2><span class="section-number">2.17.2. </span>Load relevant python packages<a class="headerlink" href="#load-relevant-python-packages" title="Permalink to this heading">#</a></h2>
<section id="check-installed-packages">
<h3><span class="section-number">2.17.2.1. </span>Check Installed Packages<a class="headerlink" href="#check-installed-packages" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">importlib.metadata</span>
<span class="k">def</span> <span class="nf">test_package</span><span class="p">(</span><span class="n">package_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test if package exists and returns version or -1&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">importlib</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">PackageNotFoundError</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;-1&#39;</span>
    <span class="k">return</span> <span class="n">version</span>

<span class="k">if</span> <span class="n">test_package</span><span class="p">(</span><span class="s1">&#39;pyTEMlib&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="s1">&#39;0.2024.1.0&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;installing pyTEMlib&#39;</span><span class="p">)</span>
    <span class="o">!{</span>sys.executable<span class="o">}</span><span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/pycroscopy/pyTEMlib.git@main<span class="w"> </span>-q<span class="w"> </span>--upgrade

<span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
    <span class="o">!{</span>sys.executable<span class="o">}</span><span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">numpy</span><span class="o">==</span><span class="m">1</span>.24.4
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>done
</pre></div>
</div>
</div>
</div>
</section>
<section id="import-numerical-and-plotting-python-packages">
<h3><span class="section-number">2.17.2.2. </span>Import numerical and plotting python packages<a class="headerlink" href="#import-numerical-and-plotting-python-packages" title="Permalink to this heading">#</a></h3>
<p>Import the python packages that we will use:</p>
<p>Beside the basic numerical (numpy) and plotting (pylab of matplotlib) libraries, we need 3D plotting library and some scipy libraries</p>
<p>and a library from pyTEMlib:</p>
<ul class="simple">
<li><p>kinematic scattering library.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span>  widget
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">output</span>
    <span class="n">output</span><span class="o">.</span><span class="n">enable_custom_widget_manager</span><span class="p">()</span>

<span class="c1"># additional package </span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span> 
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">scipy.constants</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> 

<span class="c1"># Import libraries from pyTEMlib</span>
<span class="kn">import</span> <span class="nn">pyTEMlib</span>
<span class="kn">import</span> <span class="nn">pyTEMlib.kinematic_scattering</span> <span class="k">as</span> <span class="nn">ks</span>         <span class="c1"># Kinematic sCattering Library</span>
                             <span class="c1"># Atomic form factors from Kirkland&#39;s book</span>

<span class="c1"># For archiving reasons it is a good idea to print the version numbers out at this point</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pyTEM version: &#39;</span><span class="p">,</span><span class="n">pyTEMlib</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

<span class="n">__notebook__</span> <span class="o">=</span> <span class="s1">&#39;CH2_D02-Multislice&#39;</span>
<span class="n">__notebook_version__</span> <span class="o">=</span> <span class="s1">&#39;2022_02_25&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You don&#39;t have igor2 installed.     If you wish to open igor files, you will need to install it     (pip install igor2) before attempting.
You don&#39;t have gwyfile installed.     If you wish to open .gwy files, you will need to      install it (pip install gwyfile) before attempting.
Symmetry functions of spglib enabled
Using kinematic_scattering library version {_version_ }  by G.Duscher
pyTEM version:  0.2023.9.1
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="overview-of-multislice-algorithm">
<h2><span class="section-number">2.17.3. </span>Overview of Multislice Algorithm<a class="headerlink" href="#overview-of-multislice-algorithm" title="Permalink to this heading">#</a></h2>
<p>The multislice solution is formally equivalent to a solution of the <a class="reference external" href="https://doi-org.proxy.lib.utk.edu/10.1098/rspa.1961.0157"><code class="docutils literal notranslate"><span class="pre">Howie-Whelan</span> <span class="pre">equation</span></code></a> (which is the differential form of the Bloch wave solution), if the slice thickness <span class="math notranslate nohighlight">\(\Delta\)</span>z is small enough.</p>
<p>The idea is to slice the sample into thin slices that can be handled well in electron diffraction.</p>
<p>And then we step through these slices one by one and keep track of the incoming and exiting wave.</p>
<p>We seperate (serialize) the problem to conquer it iteratively.</p>
<p>The algorithm can be divided in several steps.</p>
<ol class="arabic simple">
<li><p>So first we need the projected atomic potentials for each element.</p></li>
<li><p>Then we need to build the slices. The slices are one layer of atoms which are all at the top. And then we have vacuum for the rest.</p></li>
<li><p>The transmission function will deal with the distortion of the wave by the atom potentials.</p></li>
<li><p>The Fresnel propagator takes care of the vacuum between the atomic layers.</p></li>
<li><p>We need to define the incident wave.</p></li>
<li><p>We let this wave travel through the different layers, iteratively.</p></li>
</ol>
<p>Step 3 is done in real space and step 4 in Fourier Space and so a lot of Fourier transfom is going on. This lends itself to speed-up through parallel fast Fourier transform algorithms, which you can see at the increasing codes with gpu usage.</p>
</section>
<section id="step1-projected-potential">
<h2><span class="section-number">2.17.4. </span>Step1: Projected Potential<a class="headerlink" href="#step1-projected-potential" title="Permalink to this heading">#</a></h2>
<p>Providing the potentials and placing the atoms is a surprisingly computer intensive task for initialization of the simulation. This notebook gives up flexibility for speed in placing the atoms (no sub-pixel movement).</p>
<section id="projected-potential-from-parametrization-of-atomic-form-factor">
<h3><span class="section-number">2.17.4.1. </span>Projected Potential from Parametrization of Atomic Form Factor<a class="headerlink" href="#projected-potential-from-parametrization-of-atomic-form-factor" title="Permalink to this heading">#</a></h3>
<p>Following Kirkland (2<span class="math notranslate nohighlight">\(^nd\)</span> edition Appendix C page 252),
the atom potential is with <span class="math notranslate nohighlight">\(r^2 = x^2+z^2+z^2\)</span> and <span class="math notranslate nohighlight">\(V(x,y,z) =V(\vec{r})\)</span>
$<span class="math notranslate nohighlight">\(
v(x, y, z) =  2 \pi a_0 e_0 \int f_e(q) \exp \left( -2 \pi i \vec{q} \vec{r}  \right)  d^3r \\
= 2 \pi^2 a_0 e_0 \sum_i \frac{a_i}{r} \exp \left( -2 \pi r  \sqrt{b_i} \right) + 2\pi^{5/2} a_0 e_0 \sum_i c_i d_i^{-3/2} \exp \left(\frac{-\pi^2 r^2}{d_i} \right)
\)</span><span class="math notranslate nohighlight">\(
with \)</span>r^2 = x^2+z^2+z^2$</p>
<p>The <code class="docutils literal notranslate"><span class="pre">projected</span> <span class="pre">potential</span></code> is then:
$$
v_z(x,y) = \int_{-\inf}^{\inf} V(x,y,z) dz \
= 4 \pi^2 a_0 e_0 \sum_i a_i K_0 \left( 2 \pi r \sqrt{b_i} \right)</p>
<ul class="simple">
<li><p>2 \pi^2 a_0 e_0 \sum_i \frac{c_i}{d_i} \exp \left( \frac{-\pi^2 r^2}{d_i} \right)\
= 2 \pi^2 a_0 e_0 \left[2 \sum_i a_i K_0 \left( 2 \pi r \sqrt{b_i} \right)
+\sum_i \frac{c_i}{d_i} \exp \left( \frac{-\pi^2 r^2}{d_i} \right) \right]
$<span class="math notranslate nohighlight">\(
with \)</span> r^2 = x^2 + y^2$, we need to calculate the 1D potential only, dueto the radial symmetry of atoms.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">spherical</span> <span class="pre">Bessel</span> <span class="pre">function</span></code> <span class="math notranslate nohighlight">\(\bf K_0\)</span> is providedby the <code class="docutils literal notranslate"><span class="pre">scipy</span></code> special package.</p>
<p>We will use the last of the equations in our calculation.</p>
<p>The setting up of the potential can take quite some computer power, so there are a few constricts in this notebook on where to put the atoms, these constricts can easily be overcome</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">potential_1D</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;calculates the projected potential of an atom of element </span>
<span class="sd">    </span>
<span class="sd">    The projected potential will be in units of V nm^2,</span>
<span class="sd">    however, internally we will use Angstrom instead of nm!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># get lementary constants</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;Bohr radius&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e10</span>  <span class="c1">#in Angstrom</span>
    <span class="n">Ry_div_e</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;Rydberg constant times hc in eV&#39;</span><span class="p">)</span> <span class="c1"># in V</span>
    <span class="n">e0</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span> <span class="n">Ry_div_e</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;Bohr radius&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e10</span>

    <span class="n">pre_factor</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">e0</span>

    <span class="n">param</span> <span class="o">=</span> <span class="n">ks</span><span class="o">.</span><span class="n">electronFF</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>  <span class="c1"># parametrized form factors</span>
    <span class="n">fL</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="mi">0</span>  <span class="c1"># Lorentzian term</span>
    <span class="n">fG</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="mi">0</span>  <span class="c1"># Gaussian term</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">fL</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;fa&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">k0</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;fb&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">fG</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;fc&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;fd&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;fd&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">fL</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fL</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">pre_factor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fL</span> <span class="o">+</span> <span class="n">fG</span><span class="p">)</span> <span class="o">/</span><span class="mi">100</span> <span class="c1"># V Angstrom^2</span>
</pre></div>
</div>
</div>
</div>
<p>To retrieve the atomic projected potential, the function above uses a rather unconventional unit for the elementary charge <span class="math notranslate nohighlight">\(e\)</span>.</p>
<p>Starting from the relationship for the Rydberg energy:
$<span class="math notranslate nohighlight">\(Ry = 0.5 e^2/ a_0 \)</span>$</p>
<p>and using the value for <span class="math notranslate nohighlight">\(Ry\)</span> as 13.6 eV so that <span class="math notranslate nohighlight">\(Ry/e = 13.6\)</span> V;  we get:</p>
<div class="math notranslate nohighlight">
\[e_0 = 2* a_0 Ry/e\]</div>
<blockquote>
<div><p>The elementary charge <span class="math notranslate nohighlight">\(e_0\)</span> is then 1.44 V nm</p>
</div></blockquote>
<p>for <span class="math notranslate nohighlight">\(a_0 = 0.0529\)</span> nm</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Ry</span>  <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;Rydberg constant times hc in eV&#39;</span><span class="p">)</span> <span class="c1"># in V</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ry = </span><span class="si">{</span><span class="n">Ry</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> eV and Ry/e = </span><span class="si">{</span><span class="n">Ry</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> V&#39;</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span>  <span class="n">Ry</span> <span class="o">*</span><span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;Bohr radius&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e9</span>  <span class="c1"># conversion to nm</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;elemntary charge e = </span><span class="si">{</span><span class="n">e</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> V nm&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ry = 13.6057 eV and Ry/e = 13.6057 V
elemntary charge e = 1.4400 V nm
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-quarter-of-projected-atom-potential">
<h3><span class="section-number">2.17.4.2. </span>Plot quarter of projected atom potential<a class="headerlink" href="#plot-quarter-of-projected-atom-potential" title="Permalink to this heading">#</a></h3>
<p>We now use this function to plot a projected atom potential up in a 1nm by 1nm image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">potential_1D</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;calculates the projected potential of an atom of element </span>
<span class="sd">    </span>
<span class="sd">    The projected potential will be in units of V nm^2,</span>
<span class="sd">    however, internally we will use Angstrom instead of nm!</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># get lementary constants</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;Bohr radius&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e10</span>  <span class="c1">#in Angstrom</span>
    <span class="n">Ry_div_e</span>  <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;Rydberg constant times hc in eV&#39;</span><span class="p">)</span> <span class="c1"># in V</span>
    <span class="n">e0</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span>  <span class="n">Ry_div_e</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;Bohr radius&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e10</span>
    
    <span class="n">pre_factor</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">e0</span>

    <span class="n">param</span> <span class="o">=</span> <span class="n">ks</span><span class="o">.</span><span class="n">electronFF</span><span class="p">[</span><span class="n">element</span><span class="p">]</span>  <span class="c1"># parametrized form factors</span>
    <span class="n">fL</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="mi">0</span>  <span class="c1"># Lorentzian term</span>
    <span class="n">fG</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="mi">0</span>  <span class="c1"># Gaussian term</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">fL</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;fa&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">special</span><span class="o">.</span><span class="n">k0</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;fb&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">fG</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;fc&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;fd&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;fd&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">fL</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">fL</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">pre_factor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fL</span> <span class="o">+</span> <span class="n">fG</span><span class="p">)</span>  <span class="c1"># V Angstrom^2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------ Input ----- #</span>
<span class="n">element_name</span> <span class="o">=</span> <span class="s1">&#39;Si&#39;</span>
<span class="c1"># ------------------ #</span>

<span class="n">pixel_size</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">a_nx</span> <span class="o">=</span> <span class="n">a_ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">pixel_size</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">a_nx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">a_ny</span><span class="p">]</span> <span class="o">*</span> <span class="n">pixel_size</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span> 
<span class="c1">#r[r&lt;pixel_size] = pixel_size/4</span>
<span class="n">atom_potential</span> <span class="o">=</span> <span class="n">potential_1D</span><span class="p">(</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Overlay of direct and log plot of atomic potential of </span><span class="si">{</span><span class="n">element_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">atom_potential</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">a_nx</span><span class="o">*</span><span class="n">pixel_size</span><span class="p">,</span><span class="n">a_ny</span><span class="o">*</span><span class="n">pixel_size</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">atom_potential</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">a_nx</span><span class="o">*</span><span class="n">pixel_size</span><span class="p">,</span><span class="n">a_ny</span><span class="o">*</span><span class="n">pixel_size</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;distance ($\AA$)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0, &#39;distance ($\\AA$)&#39;)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "19e19c8a00974631baa6dfee7f106d15", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="plot-full-projected-atom-potential">
<h3><span class="section-number">2.17.4.3. </span>Plot full projected atom potential<a class="headerlink" href="#plot-full-projected-atom-potential" title="Permalink to this heading">#</a></h3>
<p>Now, that we have a quarter of the atom potential, we make the round one, by flipping our dataset around.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atom_potential_round</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="n">a_nx</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">a_ny</span><span class="p">])</span>
<span class="n">atom_potential_round</span><span class="p">[</span><span class="n">a_nx</span><span class="p">:,</span><span class="n">a_ny</span><span class="p">:]</span> <span class="o">=</span> <span class="n">atom_potential</span>
<span class="n">atom_potential_round</span><span class="p">[</span><span class="n">a_nx</span><span class="p">:,:</span><span class="n">a_ny</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">atom_potential</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">atom_potential_round</span><span class="p">[:</span><span class="n">a_nx</span><span class="p">,</span><span class="n">a_ny</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">atom_potential</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">atom_potential_round</span><span class="p">[:</span><span class="n">a_nx</span><span class="p">,:</span><span class="n">a_ny</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">atom_potential</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Log plot of atomic potential of </span><span class="si">{</span><span class="n">element_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">atom_potential_round</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">a_nx</span><span class="o">*</span><span class="n">pixel_size</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">a_ny</span><span class="o">*</span><span class="n">pixel_size</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;distance ($\AA$)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "bfcaf18bb2b84cbeb203706cb13ffc1b", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="embedd-atoms-in-projected-crystals">
<h3><span class="section-number">2.17.4.4. </span>Embedd atoms in projected crystals<a class="headerlink" href="#embedd-atoms-in-projected-crystals" title="Permalink to this heading">#</a></h3>
<p>We place the atom in the corner of a matrix with the same size as the image to be simulated.</p>
<p>With the numpy roll function we now can move this atom wherever we want, but only with pixel precision.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">size_in_pixel</span> <span class="o">=</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">ny</span> <span class="o">=</span>  <span class="mi">512</span>

<span class="n">atom_potential_corner</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">])</span>

<span class="n">atom_potential_corner</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">a_nx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">a_ny</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_potential</span>
<span class="n">atom_potential_corner</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="n">a_nx</span><span class="p">:,</span><span class="mi">0</span><span class="p">:</span><span class="n">a_ny</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">atom_potential</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">atom_potential_corner</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">a_nx</span><span class="p">,</span><span class="n">ny</span><span class="o">-</span><span class="n">a_ny</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">atom_potential</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">atom_potential_corner</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="n">a_nx</span><span class="p">:,</span><span class="n">ny</span><span class="o">-</span><span class="n">a_ny</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">atom_potential</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">atom_potential_corner</span><span class="p">,</span> <span class="n">shift</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x27f5c266950&gt;
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f027d168c5a34cb395223dd28ebfc613", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="projected-potential-of-supercell">
<h3><span class="section-number">2.17.4.5. </span>Projected Potential of Supercell<a class="headerlink" href="#projected-potential-of-supercell" title="Permalink to this heading">#</a></h3>
<p>With a projected base and unit cell we know where to place the projected potentials (in pixels). We use the translational symmetery of a crystal here to multiply the portentails in the projected unitcell to make a supercell.</p>
<p>A more sophisticated program will allow you to place atoms potentials precisly and conveniently for each slice</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">number_of_unit_cells_x</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">unit_cell_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span> <span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span> <span class="p">])</span>

<span class="n">potential_unit_cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">])</span>
<span class="n">atom_potential_corner</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">])</span>

<span class="n">potential</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">])</span>

<span class="n">atom_potential_corner</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">a_nx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">a_ny</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom_potential</span>
<span class="n">atom_potential_corner</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="n">a_nx</span><span class="p">:,</span><span class="mi">0</span><span class="p">:</span><span class="n">a_ny</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">atom_potential</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">atom_potential_corner</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">a_nx</span><span class="p">,</span><span class="n">ny</span><span class="o">-</span><span class="n">a_ny</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">atom_potential</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">atom_potential_corner</span><span class="p">[</span><span class="n">nx</span><span class="o">-</span><span class="n">a_nx</span><span class="p">:,</span><span class="n">ny</span><span class="o">-</span><span class="n">a_ny</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">atom_potential</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">unit_cell_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">unit_cell_base</span><span class="o">*</span><span class="n">nx</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span> <span class="nb">int</span><span class="p">)</span>

<span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">unit_cell_base</span><span class="p">:</span>
    <span class="n">potential_unit_cell</span> <span class="o">=</span> <span class="n">potential_unit_cell</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">atom_potential_corner</span><span class="p">,</span> <span class="n">shift</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_unit_cells_x</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_unit_cells_x</span><span class="p">):</span>
        <span class="n">potential</span> <span class="o">=</span> <span class="n">potential</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">potential_unit_cell</span><span class="p">,</span> <span class="n">shift</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">64</span><span class="p">,</span><span class="n">j</span><span class="o">*</span><span class="mi">64</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">potential</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x27f5d2bd110&gt;
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2ba7e03d5dc54fe5b9e5fdfe8440ddda", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="all-together-in-a-function">
<h3><span class="section-number">2.17.4.6. </span>All together in a function<a class="headerlink" href="#all-together-in-a-function" title="Permalink to this heading">#</a></h3>
<p>All the code from above we now collect in a single function</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">potential_2D</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">n_cell_x</span><span class="p">,</span> <span class="n">n_cell_y</span><span class="p">,</span> <span class="n">lattice_parameter</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
    <span class="n">n_cell_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n_cell_x</span><span class="p">))</span>
    <span class="n">n_cell_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n_cell_y</span><span class="p">))</span>
    
    <span class="n">pixel_size</span> <span class="o">=</span> <span class="n">lattice_parameter</span><span class="o">/</span><span class="p">(</span><span class="n">nx</span><span class="o">/</span><span class="n">n_cell_x</span><span class="p">)</span>
    
    <span class="n">a_nx</span> <span class="o">=</span> <span class="n">a_ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">pixel_size</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">a_nx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">a_ny</span><span class="p">]</span> <span class="o">*</span> <span class="n">pixel_size</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nx</span><span class="o">/</span><span class="n">n_cell_x</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span> 
    <span class="n">atom_potential</span> <span class="o">=</span> <span class="n">potential_1D</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

    <span class="n">potential</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">])</span>

    <span class="n">unit_cell_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">base</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
    <span class="n">unit_cell_base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">unit_cell_base</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
    

    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">unit_cell_base</span><span class="p">:</span>
        <span class="n">potential</span> <span class="o">=</span> <span class="n">potential</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">atom_potential_corner</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n_cell_x</span><span class="p">))):</span>
        <span class="n">potential</span> <span class="o">=</span> <span class="n">potential</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">potential</span><span class="p">,</span> <span class="n">shift</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">column</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n_cell_y</span><span class="p">))):</span>
        <span class="n">potential</span> <span class="o">=</span> <span class="n">potential</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">potential</span><span class="p">,</span> <span class="n">shift</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">row</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">potential</span>

<span class="n">size_in_pixel</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">number_layers</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">n_cell_x</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.28</span>

<span class="n">potential</span> <span class="o">=</span> <span class="n">potential_2D</span><span class="p">(</span><span class="s1">&#39;Si&#39;</span><span class="p">,</span> <span class="n">size_in_pixel</span><span class="p">,</span> <span class="n">size_in_pixel</span><span class="p">,</span> <span class="n">n_cell_x</span><span class="p">,</span> <span class="n">n_cell_x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]])</span>
<span class="n">pixel_size</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">nx</span><span class="o">/</span><span class="n">n_cell_x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">((</span><span class="n">potential</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">nx</span><span class="o">*</span><span class="n">pixel_size</span><span class="p">,</span> <span class="n">ny</span><span class="o">*</span><span class="n">pixel_size</span><span class="p">,</span> <span class="mi">0</span> <span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x27f5d30ef90&gt;
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "30b4a2f84e8440c48ce37289ca8433c7", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
</section>
<section id="step-2-slice-crystal">
<h2><span class="section-number">2.17.5. </span>Step 2: Slice Crystal.<a class="headerlink" href="#step-2-slice-crystal" title="Permalink to this heading">#</a></h2>
<p>The above crystal is an artificial construct.</p>
<p>Now we make a real crystal.</p>
<blockquote>
<div><p>For the multislice alogrithm we need to make the slices.</p>
</div></blockquote>
<p>We do this here on the based on the unit cell</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atoms</span> <span class="o">=</span> <span class="n">ks</span><span class="o">.</span><span class="n">structure_by_name</span><span class="p">(</span><span class="s1">&#39;SrTiO3&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">get_scaled_positions</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>

<span class="n">super_cell</span> <span class="o">=</span> <span class="n">ks</span><span class="o">.</span><span class="n">ball_and_stick</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

<span class="c1"># Corners and Outline of unit cell</span>
<span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">corner_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">))),</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span>
<span class="n">trace</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span>
<span class="n">corners</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">trace</span><span class="p">:</span>
    <span class="n">corners</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="n">corner_vectors</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">corner_vectors</span><span class="p">[</span><span class="n">e</span><span class="p">])])</span>

    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">super_cell</span><span class="o">.</span><span class="n">positions</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">atom</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
               <span class="n">color</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ks</span><span class="o">.</span><span class="n">jmol_colors</span><span class="p">[</span><span class="n">super_cell</span><span class="o">.</span><span class="n">get_atomic_numbers</span><span class="p">()[</span><span class="n">i</span><span class="p">]]),</span>
               <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">xx</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">z</span><span class="o">-</span><span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">.7</span><span class="p">,</span> <span class="s2">&quot;$\Delta z$&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">zs</span><span class="o">=</span><span class="p">[</span><span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 Sr [0. 0. 0.]
1 Ti [0.5 0.5 0.5]
2 O [0.5 0.5 0. ]
3 O [0.  0.5 0.5]
4 O [0.5 0.  0.5]
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1aa4b239a8154fe6935b7ee5ade1fd49", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>Here we have two equidistant layers that we can read off the z-component of the base</p>
<ul class="simple">
<li><p>one layer with z = 0.0 and</p></li>
<li><p>one layer with z = 0.5</p></li>
</ul>
<p>Let’s order atoms in a python dictionary <em>{ }</em> according to those layers</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atoms</span> <span class="o">=</span> <span class="n">ks</span><span class="o">.</span><span class="n">structure_by_name</span><span class="p">(</span><span class="s1">&#39;SrTiO3&#39;</span><span class="p">)</span>
<span class="n">lattice_parameter</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">pixel_size</span> <span class="o">=</span> <span class="n">lattice_parameter</span><span class="o">/</span><span class="p">(</span><span class="n">nx</span><span class="o">/</span><span class="n">n_cell_x</span><span class="p">)</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span> <span class="c1"># in pixel</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">pixel_size</span><span class="p">)</span>
<span class="n">layers</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:{</span><span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="s1">&#39;Sr&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scaled_position</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]]},</span> 
            <span class="mi">1</span><span class="p">:{</span><span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>  <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">atoms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scaled_position</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]]}}</span>
<span class="n">layers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:{</span><span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scaled_position</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]]},</span> 
            <span class="mi">1</span><span class="p">:{</span><span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>  <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">atoms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">scaled_position</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">atoms</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">scaled_position</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]]}}</span> 

<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 Sr [0. 0. 0.]
1 Ti [32. 32. 32.]
2 O [32. 32.  0.]
3 O [ 0. 32. 32.]
4 O [32.  0. 32.]

{0: {0: {&#39;element&#39;: &#39;Sr&#39;, &#39;base&#39;: [array([0., 0.])]}, 1: {&#39;element&#39;: &#39;O&#39;, &#39;base&#39;: [array([0.5, 0.5])]}}, 1: {0: {&#39;element&#39;: &#39;Ti&#39;, &#39;base&#39;: [array([0.5, 0.5])]}, 1: {&#39;element&#39;: &#39;O&#39;, &#39;base&#39;: [array([0. , 0.5]), array([0.5, 0. ])]}}}
</pre></div>
</div>
</div>
</div>
<p>Make slice</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">size_in_pixel</span> <span class="o">=</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">n_cell_x</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

<span class="n">pixel_size</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">nx</span><span class="o">/</span><span class="n">n_cell_x</span><span class="p">)</span>

<span class="n">image_extent</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">size_in_pixel</span><span class="o">*</span><span class="n">pixel_size</span><span class="p">,</span> <span class="n">size_in_pixel</span><span class="o">*</span><span class="n">pixel_size</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">slice_potentials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">512</span><span class="p">,</span><span class="mi">512</span><span class="p">])</span>
<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">]:</span>
        <span class="n">elem</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">atom</span><span class="p">][</span><span class="s1">&#39;element&#39;</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">atom</span><span class="p">][</span><span class="s1">&#39;base&#39;</span><span class="p">]</span>
        <span class="n">slice_potentials</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span> <span class="o">+=</span> <span class="n">potential_2D</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">n_cell_x</span><span class="p">,</span> <span class="n">n_cell_x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39; Potentials for SrTiO$_3$ Slices&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">slice_potentials</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">image_extent</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;distance ($\AA$)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Slice 0&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">slice_potentials</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">image_extent</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Slice 1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Slice 1&#39;)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "98f5e34c96e841b4a9e6504803872aa8", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="step-3-transmission-function-for-each-slice">
<h2><span class="section-number">2.17.6. </span>Step 3: Transmission Function for Each Slice<a class="headerlink" href="#step-3-transmission-function-for-each-slice" title="Permalink to this heading">#</a></h2>
<p>The slice acts like a <strong>Very Thin Specimen</strong> in the <code class="docutils literal notranslate"><span class="pre">weak</span> <span class="pre">phase</span> <span class="pre">approximation</span></code>.
In that approximation, the sample causes only a phase change to the incident plane wave.</p>
<p>To retrieve the exit wave of that slice we just multiply the transmission function <span class="math notranslate nohighlight">\(t(\vec{x})\)</span> with the plane wave <span class="math notranslate nohighlight">\(\exp (2\pi i k_z z)\)</span></p>
<div class="math notranslate nohighlight">
\[ \Psi_t(\vec{x}) = t(\vec{x}) \exp \left(2 \pi i k_z z \right) \approx t(\vec{x})  \]</div>
<p>The specimen transmission function depends on the projected potential <span class="math notranslate nohighlight">\(v_z(\vec{x})\)</span> and the interaction parameter <span class="math notranslate nohighlight">\(\sigma\)</span>:
$<span class="math notranslate nohighlight">\(t(\vec{x}) =  \exp \left( i \sigma v_z(\vec{x})\right)\)</span>$</p>
<p>with the interaction parameter <span class="math notranslate nohighlight">\(\sigma\)</span>:
$<span class="math notranslate nohighlight">\( 
\sigma = \frac{2 \pi}{\lambda V} \left(  \frac{m_0 c^2 + eV}{2m_0c^2+eV} \right) = \frac{2 \pi m  e_0 \lambda}{h^2}
\)</span><span class="math notranslate nohighlight">\(
with \)</span> m = \gamma m_0<span class="math notranslate nohighlight">\( and \)</span>eV$ the incident electron energy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">interaction_parameter</span><span class="p">(</span><span class="n">acceleration_voltage</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates interaction parameter sigma</span>
<span class="sd">    </span>
<span class="sd">    Parameter</span>
<span class="sd">    ---------</span>
<span class="sd">    acceleration_voltage: float</span>
<span class="sd">        acceleration voltage in volt</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    interaction parameter: float</span>
<span class="sd">        interaction parameter (dimensionless)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">acceleration_voltage</span> <span class="c1"># in eV</span>
    <span class="n">E0</span> <span class="o">=</span> <span class="mf">510998.95</span> <span class="c1">#  m_0 c^2 in eV</span>
    
    <span class="n">wavelength</span> <span class="o">=</span> <span class="n">ks</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="n">acceleration_voltage</span><span class="p">)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">acceleration_voltage</span>
    
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span> <span class="p">(</span><span class="n">wavelength</span> <span class="o">*</span> <span class="n">E</span><span class="p">)</span>  <span class="o">*</span><span class="p">(</span><span class="n">E0</span> <span class="o">+</span> <span class="n">E</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">E0</span><span class="o">+</span><span class="n">E</span><span class="p">)</span>


<span class="n">potential</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">slice_potentials</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_transmission</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">potential</span><span class="p">):</span>
    
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">sigma</span><span class="o">*</span> <span class="n">potential</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span>
    
<span class="n">acceleration_voltage</span> <span class="o">=</span> <span class="mi">60000</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="n">interaction_parameter</span><span class="p">(</span><span class="n">acceleration_voltage</span><span class="p">)</span>
<span class="n">transmission</span> <span class="o">=</span> <span class="n">get_transmission</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">potential</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39; Transmission Functions for SrTiO$_3$ Slices&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">transmission</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">image_extent</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;distance ($\AA$)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Slice 0&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">transmission</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">image_extent</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Slice 1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Slice 1&#39;)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "40799747ee0b432f8ec6d6040741477e", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="step-4-propagator">
<h2><span class="section-number">2.17.7. </span>Step 4: Propagator<a class="headerlink" href="#step-4-propagator" title="Permalink to this heading">#</a></h2>
<p>The Fresnel propagator <span class="math notranslate nohighlight">\(p\)</span> propagates the wave through the vacuum of the layers between the (flat) atom potentials.
$<span class="math notranslate nohighlight">\(
p(x,y, \Delta z) = \mathcal{F} P(k_x, k_y, \Delta z)
\)</span><span class="math notranslate nohighlight">\(
Mathematically, this propagator function has to be  convoluted with the wave, which is a multiplication in Fourier space \)</span>\mathcal{F}$.</p>
<div class="math notranslate nohighlight">
\[
P(k,\Delta z) = \exp(-i\pi \lambda k^2 \Delta z)
\]</div>
<p>The Fourier space is limited in reciprocal vector to avoid aliasing. We realize that with  an aperture function.</p>
<p>Here we assume a cubic crystal and equidistant layers, but that of course is not always true.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lattice_parameter</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">field_of_view</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">lattice_parameter</span>
<span class="n">size_in_pixel</span> <span class="o">=</span> <span class="mi">512</span>
<span class="n">number_layers</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">delta_z</span> <span class="o">=</span> <span class="p">[</span><span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">number_layers</span><span class="p">,</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">number_layers</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">delta_z</span><span class="p">)</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="n">ks</span><span class="o">.</span><span class="n">get_wavelength</span><span class="p">(</span><span class="mi">400000</span><span class="p">)</span>
<span class="n">bandwidth_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span>   <span class="c1"># Antialiasing bandwidth limit factor</span>

<span class="k">def</span> <span class="nf">get_propagator</span><span class="p">(</span><span class="n">size_in_pixel</span><span class="p">,</span> <span class="n">delta_z</span><span class="p">,</span> <span class="n">number_layers</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">field_of_view</span><span class="p">,</span> <span class="n">bandwidth_factor</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="n">k2max</span> <span class="o">=</span> <span class="n">size_in_pixel</span><span class="o">/</span><span class="n">field_of_view</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">bandwidth_factor</span> 
    <span class="nb">print</span><span class="p">(</span><span class="n">k2max</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bandwidth limited to a real space resolution of </span><span class="si">{</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k2max</span><span class="o">*</span><span class="mi">1000</span><span class="si">}</span><span class="s2"> pm&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   (= </span><span class="si">{</span><span class="n">wavelength</span><span class="o">*</span><span class="n">k2max</span><span class="o">*</span><span class="mf">1000.0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> mrad)  for symmetrical anti-aliasing.&quot;</span><span class="p">)</span>
    <span class="n">k2max</span> <span class="o">=</span> <span class="n">k2max</span><span class="o">*</span><span class="n">k2max</span><span class="p">;</span>

    <span class="n">kx</span><span class="p">,</span><span class="n">ky</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="o">-</span><span class="n">size_in_pixel</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span><span class="n">size_in_pixel</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">size_in_pixel</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span><span class="n">size_in_pixel</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">field_of_view</span>
    <span class="n">k_square</span> <span class="o">=</span> <span class="n">kx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ky</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">k_square</span><span class="p">[</span><span class="n">k_square</span><span class="o">&gt;</span><span class="n">k2max</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># bandwidth limiting</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">size_in_pixel</span><span class="p">,</span><span class="n">size_in_pixel</span><span class="p">])</span> 
        <span class="n">temp</span><span class="p">[</span><span class="n">k_square</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of symmetrical non-aliasing beams = </span><span class="si">{</span><span class="n">temp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
    <span class="n">propagator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">number_layers</span><span class="p">,</span> <span class="n">size_in_pixel</span><span class="p">,</span> <span class="n">size_in_pixel</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_layers</span><span class="p">):</span>
        <span class="n">propagator</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">wavelength</span><span class="o">*</span><span class="n">k_square</span><span class="o">*</span><span class="n">delta_z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">propagator</span>

<span class="n">propagator</span> <span class="o">=</span> <span class="n">get_propagator</span><span class="p">(</span><span class="n">size_in_pixel</span><span class="p">,</span> <span class="n">delta_z</span><span class="p">,</span> <span class="n">number_layers</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">field_of_view</span><span class="p">,</span> 
                             <span class="n">bandwidth_factor</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">recip_FOV</span> <span class="o">=</span> <span class="n">size_in_pixel</span><span class="o">/</span><span class="n">field_of_view</span><span class="o">/</span><span class="mf">2.</span>
<span class="n">reciprocal_extent</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">recip_FOV</span><span class="p">,</span><span class="n">recip_FOV</span><span class="p">,</span><span class="n">recip_FOV</span><span class="p">,</span><span class="o">-</span><span class="n">recip_FOV</span><span class="p">]</span>
<span class="n">layer</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;propagator of delta z = </span><span class="si">{</span><span class="n">delta_z</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> $\AA$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;real part&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">propagator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">reciprocal_extent</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;frequency (1/$\AA$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;imaginary part&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;frequency (1/$\AA$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">propagator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">reciprocal_extent</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.952634, 1.952634]
5.462706614074458
Bandwidth limited to a real space resolution of 183.05943750000003 pm
   (= 89.80 mrad)  for symmetrical anti-aliasing.
Number of symmetrical non-aliasing beams = 91528
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x27f5e9999d0&gt;
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ce88414b04404905bd4b4173263203fa", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="step-5-incident-wave">
<h2><span class="section-number">2.17.8. </span>Step 5: Incident Wave<a class="headerlink" href="#step-5-incident-wave" title="Permalink to this heading">#</a></h2>
<p>That will be easy, in plane wave illumination all points have the same amplitude (here: 1) and phase (here: 0). We express that plane wave as a complex array.</p>
<p>A tilted plane would be a little more complicated.</p>
<blockquote>
<div><p>What would we need to do for a tilted beam?</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tilt not implemented yet</span>
<span class="n">plane_wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-6-multislice-loop">
<h2><span class="section-number">2.17.9. </span>Step 6: Multislice Loop<a class="headerlink" href="#step-6-multislice-loop" title="Permalink to this heading">#</a></h2>
<p>Combining the transmission function <span class="math notranslate nohighlight">\(t\)</span> and the Frensel propagator <span class="math notranslate nohighlight">\(p\)</span> we get
for each slice:
$<span class="math notranslate nohighlight">\(
\Psi(x,y,z+\Delta z) = p(x,y,\Delta z) \otimes \left[t(x,y,z)\Psi(x,y,z) \right] + \mathcal{O}(\Delta z^2)
\)</span>$</p>
<p>or an expression that bettere relfects the iterative nature of this equation for starting layer n :</p>
<div class="math notranslate nohighlight">
\[
\Psi_{n+1}(x,y,) = p_n(x,y,\Delta z) \otimes \left[t_n(x,y,z)\Psi_n(x,y,z) \right] + \mathcal{O}(\Delta z^2)
\]</div>
<p>Again the convolution <span class="math notranslate nohighlight">\(\otimes\)</span> will be done as a multiplication in Fourier space.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ------Input------------- #</span>
<span class="n">number_of_unit_cell_z</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># this will give us the thickness</span>
<span class="c1"># ------------------------ #    </span>

<span class="k">def</span> <span class="nf">multi_slice</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">number_of_unit_cell_z</span><span class="p">,</span> <span class="n">acceleration_voltage</span><span class="p">,</span> <span class="n">transmission</span><span class="p">,</span> <span class="n">propagator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multislice Calculation</span>
<span class="sd">    </span>
<span class="sd">    One the array wave will be changed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">interaction_parameter</span><span class="p">(</span><span class="n">acceleration_voltage</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_unit_cell_z</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_layers</span><span class="p">):</span> 
            <span class="n">wave</span> <span class="o">=</span> <span class="n">wave</span> <span class="o">*</span> <span class="n">transmission</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span> <span class="c1"># transmission  - real space</span>
            <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
            <span class="n">wave</span> <span class="o">=</span> <span class="n">wave</span> <span class="o">*</span> <span class="n">propagator</span><span class="p">[</span><span class="n">layer</span><span class="p">]</span>  <span class="c1"># propagation; propagator is defined in reciprocal space</span>
            <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft2</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span> <span class="c1">#back to real space</span>
    <span class="k">return</span> <span class="n">wave</span>

<span class="n">plane_wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">size_in_pixel</span><span class="p">,</span><span class="n">size_in_pixel</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">exit_wave</span> <span class="o">=</span> <span class="n">multi_slice</span><span class="p">(</span><span class="n">plane_wave</span><span class="p">,</span> <span class="n">number_of_unit_cell_z</span><span class="p">,</span> <span class="n">acceleration_voltage</span><span class="p">,</span> <span class="n">transmission</span><span class="p">,</span> <span class="n">propagator</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;simulated </span><span class="si">{</span><span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> for thickness </span><span class="si">{</span><span class="n">number_of_unit_cell_z</span><span class="o">*</span><span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> Angstrom&quot;</span><span class="p">)</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">exit_wave</span><span class="p">)</span>
<span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft2</span><span class="p">(</span><span class="n">wave</span><span class="o">*</span><span class="n">wave</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;intensity of exit wave&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="n">extent</span> <span class="o">=</span> <span class="n">image_extent</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;distance ($\AA$)&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>simulated SrTiO3 for thickness 19.526 Angstrom
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cd79217348cd43fe9c551a5d2f2eaf61", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="diffraction-pattern">
<h2><span class="section-number">2.17.10. </span>Diffraction Pattern<a class="headerlink" href="#diffraction-pattern" title="Permalink to this heading">#</a></h2>
<p>according to <a class="reference external" href="https://doi.org/10.1107/S0365110X57002194">J. M. Cowley and A. F. Moodie</a>, the diffraction pattern <span class="math notranslate nohighlight">\(U(u,v)\)</span> is the Fourier transform of the exit wave function in the far-field (diffraction plane):</p>
<div class="math notranslate nohighlight">
\[
U(u,v) = \mathcal{F} \left( \exp(i*\varphi(x,y)) \right)
\]</div>
<p>where <span class="math notranslate nohighlight">\(\varphi\)</span> is the exit wave of the crystal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">additional_layers</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">diffraction_pattern</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">exit_wave</span><span class="p">)))</span>
<span class="n">diffraction_pattern</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># adding a multislice calculation</span>
<span class="n">exit_wave2</span> <span class="o">=</span> <span class="n">multi_slice</span><span class="p">(</span><span class="n">exit_wave</span><span class="p">,</span> <span class="n">additional_layers</span><span class="p">,</span> <span class="n">acceleration_voltage</span><span class="p">,</span> <span class="n">transmission</span><span class="p">,</span> <span class="n">propagator</span><span class="p">)</span>
<span class="n">diffraction_pattern2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">exit_wave2</span><span class="p">)))</span>
<span class="n">diffraction_pattern2</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;simulated diffraction patterns of </span><span class="si">{</span><span class="n">atoms</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;thickness </span><span class="si">{</span><span class="n">number_of_unit_cell_z</span><span class="o">*</span><span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> nm&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diffraction_pattern</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="n">reciprocal_extent</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;spatial frequency (1/$\AA$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;thickness </span><span class="si">{</span><span class="p">(</span><span class="n">number_of_unit_cell_z</span><span class="o">+</span><span class="n">additional_layers</span><span class="p">)</span><span class="o">*</span><span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> $\AA$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diffraction_pattern2</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="n">reciprocal_extent</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;spatial frequency (1/$\AA$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "8852485eceb540bebd0e77b93e168a65", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="summary">
<h2><span class="section-number">2.17.11. </span>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p>The multislice algrithm allows to calculate all the dynamic diffraction effects we need.</p>
<p>More sophisticated program allow more flexibility and include frozen phonon calculations. Of course those programs are also faster and allow to select a variety of outputs.</p>
</section>
<section id="navigation">
<h2><span class="section-number">2.17.12. </span>Navigation<a class="headerlink" href="#navigation" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><font size = "3">  <strong>Back: <a class="reference internal" href="CH2_D01-Bloch.html"><span class="doc std std-doc">Mutli-Slice Theory</span></a></strong> </font></p></li>
<li><p><font size = "3">  <strong>Next: <a class="reference internal" href="CH2_D03-Multislice_CBED.html"><span class="doc std std-doc">CBED Mutli-Slice Theory</span></a></strong> </font></p></li>
<li><p><font size = "3">  <strong>Chapter 2: <a class="reference internal" href="CH2_00-Diffraction.html"><span class="doc std std-doc">Diffraction</span></a></strong> </font></p></li>
<li><p><font size = "3">  <strong>List of Content: <a class="reference internal" href="../_MSE672_Intro_TEM.html"><span class="doc std std-doc">Front</span></a></strong> </font></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "pytemlib"
        },
        kernelOptions: {
            name: "pytemlib",
            path: "./Diffraction"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'pytemlib'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="CH2_D01-Bloch.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">2.16. </span>Bethe Theory</p>
      </div>
    </a>
    <a class="right-next"
       href="CH2_D03-Multislice_CBED.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">2.18. </span>CBED - Multislice Algorithm</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">2.17.1. Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-relevant-python-packages">2.17.2. Load relevant python packages</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-installed-packages">2.17.2.1. Check Installed Packages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-numerical-and-plotting-python-packages">2.17.2.2. Import numerical and plotting python packages</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview-of-multislice-algorithm">2.17.3. Overview of Multislice Algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step1-projected-potential">2.17.4. Step1: Projected Potential</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#projected-potential-from-parametrization-of-atomic-form-factor">2.17.4.1. Projected Potential from Parametrization of Atomic Form Factor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-quarter-of-projected-atom-potential">2.17.4.2. Plot quarter of projected atom potential</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-full-projected-atom-potential">2.17.4.3. Plot full projected atom potential</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#embedd-atoms-in-projected-crystals">2.17.4.4. Embedd atoms in projected crystals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#projected-potential-of-supercell">2.17.4.5. Projected Potential of Supercell</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#all-together-in-a-function">2.17.4.6. All together in a function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-slice-crystal">2.17.5. Step 2: Slice Crystal.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-transmission-function-for-each-slice">2.17.6. Step 3: Transmission Function for Each Slice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-propagator">2.17.7. Step 4: Propagator</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-5-incident-wave">2.17.8. Step 5: Incident Wave</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-6-multislice-loop">2.17.9. Step 6: Multislice Loop</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diffraction-pattern">2.17.10. Diffraction Pattern</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">2.17.11. Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#navigation">2.17.12. Navigation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Gerd Duscher UTK/IAMM
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>